---
phase: 44-audio-completion
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - autoloads/audio_manager.gd
  - assets/audio/AUDIO_README.md
autonomous: false

must_haves:
  truths:
    - "Rooftops zone plays its own music track (not neighborhood fallback)"
    - "Sewers zone plays its own music track (not silent)"
    - "No orphaned metadata files clutter the music directory"
  artifacts:
    - path: "autoloads/audio_manager.gd"
      provides: "Rooftops zone audio mappings"
      contains: "rooftops"
    - path: "assets/audio/music/rooftops_a.wav"
      provides: "Rooftops zone music (version A)"
    - path: "assets/audio/music/sewers_a.wav"
      provides: "Sewers zone music (version A)"
  key_links:
    - from: "autoloads/audio_manager.gd"
      to: "assets/audio/music/rooftops_a.wav"
      via: "ZONE_TRACK_MAP + music_tracks dict"
      pattern: "rooftops.*res://assets/audio/music/rooftops"
---

<objective>
Wire rooftops zone into the audio system, fill missing zone music gaps (sewers + rooftops), and clean up unused AI-generated audio candidates.

Purpose: Rooftops zone currently falls back to neighborhood music (not mapped). Sewers zone is mapped but has no file (plays silent). Both need real tracks. There are 18+ unused AI-generated candidate tracks that need curation.

Output: Every zone has dedicated music. Orphaned metadata cleaned up. Audio directory organized.
</objective>

<context>
@docs/STATE.md
@autoloads/audio_manager.gd
@assets/audio/AUDIO_README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add rooftops zone to audio mappings</name>
  <files>autoloads/audio_manager.gd</files>
  <action>
  Add rooftops zone to all four audio mapping locations in audio_manager.gd:

  1. **ZONE_TRACK_MAP** (line ~75-85): Add entry:
     ```
     "rooftops": "rooftops",
     ```

  2. **ZONE_BASE_TRACK_MAP** (line ~88-97): Add entry:
     ```
     "rooftops": "rooftops",
     ```

  3. **music_tracks** dict (line ~163-194): Add entry after the sewers line:
     ```
     "rooftops": "res://assets/audio/music/rooftops.wav",
     ```

  4. **ab_tracks** array (line ~249-258): Add "rooftops" and "sewers" to the list. Currently sewers is in music_tracks but not in ab_tracks.

  The files don't exist yet — AudioManager handles this gracefully (warning + _failed_tracks cache, no crash). Task 3 will create the actual files.
  </action>
  <verify>
  1. Grep audio_manager.gd for "rooftops" — should appear in ZONE_TRACK_MAP, ZONE_BASE_TRACK_MAP, music_tracks, and ab_tracks
  2. Grep for "sewers" in ab_tracks — should now be present
  </verify>
  <done>
  Rooftops zone is fully wired into the audio system. When rooftops.wav (or rooftops_a/b.wav) files exist, the zone will automatically play its own music.
  </done>
</task>

<task type="auto">
  <name>Task 2: Clean up orphaned metadata and catalog candidates</name>
  <files>assets/audio/AUDIO_README.md</files>
  <action>
  1. **Identify orphaned .txt files**: In `assets/audio/music/`, many `momichronicles2-Untitled-*.wav.txt` files exist without matching .wav files. These are metadata-only leftovers from Suno generation. Delete all .txt files that have NO matching .wav file in the same directory. Keep .txt files that DO have a matching .wav.

  To identify: a .txt file like `momichronicles2-Untitled-XXXX.wav.txt` is orphaned if `momichronicles2-Untitled-XXXX.wav` does NOT exist and `momichronicles2-Untitled-XXXX.wav.import` does NOT exist.

  2. **Catalog remaining candidates**: For the AI-generated tracks that DO have .wav files, read their .txt metadata to extract the title and Suno prompt. The named `momi_chronicle-*` tracks have descriptive names already. The `momichronicles2-Untitled-*` tracks need their .txt read for context.

  3. **Update AUDIO_README.md**: Update the "Missing Audio" section to list which candidates could fill the sewers and rooftops gaps. Include the candidate filenames and their Suno-generated titles/descriptions. The user will need to listen to these and pick the best fits.

  Candidates likely suitable for sewers (dark/underground):
  - `momi_chronicle-Backyard_Zone_(Danger_Area)-*.wav` — described as "tense", "danger", "prowling through shadows"
  - Any momichronicles2-Untitled-* that have dark/tense descriptions

  Candidates likely suitable for rooftops (moonlit/atmospheric):
  - Any momichronicles2-Untitled-* that have atmospheric/night descriptions
  - `momi_chronicle-Canine_Clash_at_Pixel_Pass-*.wav` might work if it's more atmospheric than combat
  </action>
  <verify>
  1. No orphaned .txt files remain (every .txt has a matching .wav or .wav.import)
  2. AUDIO_README.md has an updated "Candidate Assignment" section with recommendations
  </verify>
  <done>
  Music directory is clean. Remaining AI candidates are cataloged with descriptions. AUDIO_README.md provides a clear guide for the user to pick tracks.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
  Audio mappings wired for rooftops zone. Orphaned metadata cleaned. AI candidates cataloged in AUDIO_README.md with recommendations for sewers and rooftops.
  </what-built>
  <how-to-verify>
  1. Open the game and visit rooftops zone — should now play "rooftops" track (will be silent until files placed, but no longer plays neighborhood music)
  2. Review the candidate list in AUDIO_README.md
  3. Listen to the candidate .wav files listed and pick:
     - **Sewers A/B tracks**: 2 tracks for dark underground zone
     - **Rooftops A/B tracks**: 2 tracks for moonlit nighttime zone
  4. Tell me your picks — which candidate file should become which track name:
     - `sewers_a.wav` ← [your pick]
     - `sewers_b.wav` ← [your pick]
     - `rooftops_a.wav` ← [your pick]
     - `rooftops_b.wav` ← [your pick]
  5. Alternatively: say "generate new" if none of the candidates fit, or "skip" to leave zones with fallback music for now
  </how-to-verify>
  <resume-signal>Tell me your track assignments, "generate new", or "skip"</resume-signal>
</task>

</tasks>

<verification>
- audio_manager.gd has "rooftops" in all 4 mapping locations
- No orphaned .txt files in assets/audio/music/
- AUDIO_README.md updated with candidate catalog
- All existing audio still works (no regressions)
</verification>

<success_criteria>
Every zone (neighborhood, backyard, sewers, rooftops, boss_arena) has a dedicated music track entry in AudioManager. User has a clear catalog of AI-generated candidates to choose from for the missing sewers and rooftops tracks. Audio directory is clean of orphaned metadata.
</success_criteria>

<output>
After completion, create `docs/phases/44-audio-completion/44-01-SUMMARY.md`
</output>
