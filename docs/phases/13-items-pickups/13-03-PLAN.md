---
phase: 13-items-pickups
plan: 03
type: execute
wave: 3
depends_on: ["13-02"]
files_modified:
  - ui/hud/coin_counter.gd
  - ui/hud/coin_counter.tscn
  - ui/hud/game_hud.tscn
  - autoloads/effects_manager.gd
  - components/health/health_pickup.gd
  - components/pickup/coin_pickup.gd
autonomous: true

must_haves:
  truths:
    - "Coin count visible in HUD"
    - "Coin counter updates on collection"
    - "Collection has particle/visual effect"
    - "Counter animates on coin gain"
  artifacts:
    - path: "ui/hud/coin_counter.gd"
      provides: "Coin display UI"
      exports: ["CoinCounter"]
    - path: "ui/hud/coin_counter.tscn"
      provides: "Coin counter scene"
  key_links:
    - from: "coin_counter.gd"
      to: "events.gd"
      via: "coins_changed connection"
      pattern: "coins_changed\\.connect"
    - from: "effects_manager.gd"
      to: "pickup collection"
      via: "spawn_pickup_effect"
      pattern: "spawn_pickup_effect"
---

<objective>
Add HUD coin counter and collection effects for satisfying feedback.

Purpose: Show player their coin count, make collection feel rewarding
Output: Coin counter in HUD, visual effects on pickup collection
</objective>

<execution_context>
@~/.config/Claude/get-shit-done/workflows/execute-plan.md
@~/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-items-pickups/13-02-SUMMARY.md
@ui/hud/health_bar.gd
@ui/hud/game_hud.tscn
@autoloads/effects_manager.gd
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create coin counter UI</name>
  <files>
    ui/hud/coin_counter.gd
    ui/hud/coin_counter.tscn
    ui/hud/game_hud.tscn
  </files>
  <action>
Create CoinCounter UI component:

coin_counter.gd:
```gdscript
extends Control
class_name CoinCounter
## Displays player's coin count with smooth counting animation.

@onready var icon: Polygon2D = $HBoxContainer/Icon
@onready var label: Label = $HBoxContainer/Label

var display_coins: int = 0
var target_coins: int = 0

func _ready() -> void:
    Events.coins_changed.connect(_on_coins_changed)
    # Initialize from GameManager
    target_coins = GameManager.get_coins()
    display_coins = target_coins
    _update_display()

func _process(delta: float) -> void:
    # Smooth counting animation
    if display_coins != target_coins:
        var diff = target_coins - display_coins
        var step = max(1, abs(diff) * 10 * delta)
        if diff > 0:
            display_coins = min(display_coins + int(step), target_coins)
        else:
            display_coins = max(display_coins - int(step), target_coins)
        _update_display()

func _on_coins_changed(total: int) -> void:
    var gained = total > target_coins
    target_coins = total
    # Pop animation on gain
    if gained:
        _pop_animation()

func _update_display() -> void:
    if label:
        label.text = str(display_coins)

func _pop_animation() -> void:
    # Quick scale pop
    var tween = create_tween()
    tween.tween_property(self, "scale", Vector2(1.3, 1.3), 0.08)
    tween.tween_property(self, "scale", Vector2(1.0, 1.0), 0.12).set_ease(Tween.EASE_OUT)
```

coin_counter.tscn:
```
[gd_scene load_steps=2 format=3]

[ext_resource type="Script" path="res://ui/hud/coin_counter.gd" id="1"]

[node name="CoinCounter" type="Control"]
custom_minimum_size = Vector2(50, 12)
script = ExtResource("1")

[node name="HBoxContainer" type="HBoxContainer" parent="."]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
theme_override_constants/separation = 4

[node name="Icon" type="Polygon2D" parent="HBoxContainer"]
color = Color(1, 0.85, 0.2, 1)
polygon = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)

[node name="Label" type="Label" parent="HBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 8
text = "0"
```

Update game_hud.tscn:
- Add CoinCounter to top-right area
- Position after VBoxContainer, anchored top-right with margin
  </action>
  <verify>
Coin counter visible in top-right of HUD
Shows "0" initially (or current coin count)
Updates when collecting coins
Has pop animation when coins gained
Has smooth counting animation (doesn't jump)
  </verify>
  <done>Coin counter displays in HUD, animates on collection</done>
</task>

<task type="auto">
  <name>Task 2: Add collection visual effects</name>
  <files>
    autoloads/effects_manager.gd
    components/health/health_pickup.gd
    components/pickup/coin_pickup.gd
  </files>
  <action>
Add pickup collection effects to EffectsManager:

```gdscript
## Spawn pickup collection particles
func spawn_pickup_effect(position: Vector2, color: Color) -> void:
    # Spawn 5-8 small particles that burst outward
    var particle_count = randi_range(5, 8)
    for i in particle_count:
        var particle = ColorRect.new()
        particle.size = Vector2(2, 2)
        particle.color = color
        particle.position = position - Vector2(1, 1)  # Center
        get_tree().current_scene.add_child(particle)
        
        # Animate outward and fade
        var tween = particle.create_tween()
        var direction = Vector2(randf_range(-1, 1), randf_range(-1, 1)).normalized()
        var end_pos = position + direction * randf_range(12, 20)
        tween.set_parallel(true)
        tween.tween_property(particle, "position", end_pos, 0.25)
        tween.tween_property(particle, "modulate:a", 0.0, 0.25)
        tween.chain().tween_callback(particle.queue_free)

## Quick flash at position (for emphasis)
func flash_pickup(position: Vector2, color: Color) -> void:
    var flash = ColorRect.new()
    flash.size = Vector2(12, 12)
    flash.position = position - Vector2(6, 6)
    flash.color = color
    flash.modulate.a = 0.7
    get_tree().current_scene.add_child(flash)
    
    var tween = flash.create_tween()
    tween.set_parallel(true)
    tween.tween_property(flash, "scale", Vector2(1.5, 1.5), 0.12)
    tween.tween_property(flash, "modulate:a", 0.0, 0.12)
    tween.chain().tween_callback(flash.queue_free)
```

Update health_pickup.gd _on_body_entered:
Add visual effects after healing:
```gdscript
# Add after AudioManager.play_sfx:
EffectsManager.spawn_pickup_effect(global_position, Color(1.0, 0.4, 0.5))  # Pink
EffectsManager.flash_pickup(global_position, Color(1.0, 0.8, 0.8))
```

Update coin_pickup.gd _on_body_entered (if not already there):
Add visual effects:
```gdscript
# Add after AudioManager.play_sfx:
EffectsManager.spawn_pickup_effect(global_position, Color(1.0, 0.85, 0.2))  # Gold
EffectsManager.flash_pickup(global_position, Color(1.0, 1.0, 0.7))
```
  </action>
  <verify>
Collect health pickup - pink particle burst, flash
Collect coin - gold particle burst, flash
Effects are brief and satisfying
  </verify>
  <done>Pickup collection has satisfying visual feedback</done>
</task>

</tasks>

<verification>
1. Run game
2. Coin counter visible top-right (shows 0 initially)
3. Kill enemy - drops appear with spread
4. Collect coin:
   - Gold particles burst
   - "Ching" sound plays
   - Counter pops and increments smoothly
5. Collect health:
   - Pink particles burst
   - Softer pickup sound plays
   - HP increases
</verification>

<success_criteria>
- Coin counter visible in HUD top-right
- Counter shows current coin count from GameManager
- Counter animates smoothly when coins collected (counting up)
- Counter pops briefly on coin gain
- Gold particle burst on coin collection
- Pink particle burst on health collection
- Quick flash effect on both pickups
- All feedback feels satisfying and responsive
</success_criteria>

<output>
After completion, create `.planning/phases/13-items-pickups/13-03-SUMMARY.md`
</output>
