---
phase: 31-art-generation
plan: 02
type: execute
wave: 2
depends_on: ["31-01"]
files_modified:
  - art/reference/README.md
autonomous: false

must_haves:
  truths:
    - "art/reference/ directory exists with user-selected reference images for style consistency"
    - "Script runs successfully with --reference-dir art/reference/ and generates at least one test image"
    - "Generated test image matches the reference art style (user verified)"
    - "User has reviewed generation quality and approved proceeding to full batch"
  artifacts:
    - path: "art/reference/README.md"
      provides: "Instructions for selecting and managing reference images"
    - path: "art/generated/characters/momi_idle.png"
      provides: "At minimum, Momi idle sprite generated as proof the pipeline works"
  key_links:
    - from: "tools/gemini_api_generate.py"
      to: "art/reference/"
      via: "--reference-dir flag"
    - from: "art/generated/"
      to: "phases 32-35 plans"
      via: "sprite file paths expected by integration plans"
---

<objective>
Set up the reference images directory, run a test generation to verify Nano Banana Pro produces viable art, then run the full batch generation for all 96 game sprites. User reviews quality at checkpoint.

Purpose: The API script from Plan 01 needs to be validated with real API calls and real reference images before committing to a full 96-image generation run. The user needs to select their best reference images and verify the output quality matches their vision.
Output: All 96 sprite PNGs generated in art/generated/ ready for rip_sprites.py processing.
</objective>

<execution_context>
@~/.config/Claude/get-shit-done/workflows/execute-plan.md
@~/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-art-generation/31-01-SUMMARY.md
@tools/gemini_api_generate.py
@art/style_context.txt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reference directory structure and run dry-run validation</name>
  <files>
    art/reference/README.md
  </files>
  <action>
  **1. Create art/reference/ directory:**
  ```bash
  mkdir -p art/reference
  ```

  **2. Create art/reference/README.md** with instructions:
  ```markdown
  # Reference Images for Nano Banana Pro

  Place 3-5 of your best reference images here for style consistency.

  ## How to select reference images

  From C:\Projects\MomiAdventure\gemini_images\, pick images that:
  - Best represent the pixel art style you want
  - Show the characters (Momi, Cinnamon, Philo) looking how you want them
  - Are under 10MB each (large images get auto-resized to 1024px)

  ## Recommended anchors

  - 1 image of Momi that nails her look
  - 1 image showing the overall game art style
  - 1 image of a scene/environment you like
  - (Optional) 1-2 more images that represent the vibe

  ## Usage

  The script loads all images from this directory automatically:
  ```
  python tools/gemini_api_generate.py --reference-dir art/reference/
  ```

  Files are loaded alphabetically. Name them with numeric prefixes to control order:
  - 01_momi_anchor.png
  - 02_style_anchor.png
  - 03_scene_anchor.png
  ```

  **3. Run dry-run validation:**
  ```bash
  python tools/gemini_api_generate.py --list
  python tools/gemini_api_generate.py --dry-run
  ```
  Verify:
  - All 96 prompts listed from prompts.json (not v2)
  - Dry run completes with correct category/entity names
  - No import errors or path issues

  **4. Verify reference image loading works** (even with empty dir):
  ```bash
  python tools/gemini_api_generate.py --dry-run --reference-dir art/reference/
  ```
  Should show "0 reference images loaded" and continue normally.
  </action>
  <verify>
  - `art/reference/README.md` exists with selection instructions
  - `python tools/gemini_api_generate.py --list` shows 96 prompts
  - `python tools/gemini_api_generate.py --dry-run` completes successfully
  - `python tools/gemini_api_generate.py --dry-run --reference-dir art/reference/` runs without error
  </verify>
  <done>Reference directory created with instructions, dry-run validation passes, script loads prompts correctly</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
  The Nano Banana Pro art generation pipeline is ready to run:
  - Script updated for generate_content() API with reference image support
  - Style context file provides consistent art direction
  - 96 prompts mapped to all game entities
  - Reference image directory ready for your selections
  </what-built>
  <how-to-verify>
  **Step 1: Select your reference images**

  From `C:\Projects\MomiAdventure\gemini_images\`, pick 3-5 images that best represent your target art style. Copy them to `momi-chronicles/art/reference/`:
  ```
  copy "C:\Projects\MomiAdventure\gemini_images\YOUR_FAVORITES.png" art\reference\
  ```
  Rename with numeric prefixes (01_, 02_, etc.) to control loading order.

  **Step 2: Test with a single sprite**

  Generate just Momi's idle sprite to verify quality:
  ```
  python tools/gemini_api_generate.py --single 0 --reference-dir art/reference/ --api-key YOUR_KEY
  ```
  Check `art/generated/characters/momi_idle.png` â€” does it match the vibe?

  If quality is wrong:
  - Try different reference images
  - Try `--model gemini-3-pro-image-preview` for Nano Banana Pro (may need billing)
  - Edit `art/style_context.txt` to refine directions

  **Step 3: Test a small category**
  ```
  python tools/gemini_api_generate.py --category characters --reference-dir art/reference/ --api-key YOUR_KEY
  ```
  Review all character sprites in `art/generated/characters/`.

  **Step 4: Full generation run (when satisfied)**
  ```
  python tools/gemini_api_generate.py --reference-dir art/reference/ --api-key YOUR_KEY
  ```
  This generates all 96 sprites. Takes ~10-15 minutes with rate limiting.

  **Step 5: Post-process**
  ```
  python art/rip_sprites.py
  ```
  This removes backgrounds and downscales to game sizes.

  **Step 6: Verify coverage**

  Check that these critical files exist in `art/generated/`:
  - `characters/momi_idle.png` through `momi_death.png` (10 states)
  - `characters/cinnamon_idle.png` through `cinnamon_overheat.png` (4 states)
  - `characters/philo_idle.png` through `philo_motivated.png` (5 states)
  - `enemies/raccoon_idle.png`, `crow_idle.png`, `stray_cat_idle.png`, etc.
  - `bosses/raccoon_king_normal.png`, `raccoon_king_enrage.png`
  - `items/` and `equipment/` icons
  </how-to-verify>
  <resume-signal>Type "approved" when sprites look good, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. art/reference/ directory exists with user's selected reference images
2. At least one test sprite generated successfully via Nano Banana Pro API
3. User has reviewed quality and confirmed the art style matches their vision
4. Full generation run completed (or user knows how to complete it)
5. rip_sprites.py processing produces transparent game-ready PNGs
</verification>

<success_criteria>
- Reference images selected and loaded by script
- Generation pipeline produces viable sprites (user approved quality)
- All 96 game entity sprites exist in art/generated/ with correct filenames
- Sprites processed by rip_sprites.py into game-ready transparent PNGs
- Phase 31 gate criteria met: sprites ready for Phases 32-35 integration
</success_criteria>

<output>
After completion, create `.planning/phases/31-art-generation/31-02-SUMMARY.md`
</output>
