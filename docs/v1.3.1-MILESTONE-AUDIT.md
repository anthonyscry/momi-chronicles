---
milestone: v1.3.1
audited: 2026-01-29
status: tech_debt
scores:
  requirements: 5/5 tech debt items
  phases: 2/2 verified
  integration: 6/7
  flows: 2.5/3
gaps:
  requirements: []
  integration:
    - "PartyManager.load_save_data() saves companion health/meters but never restores them (pre-existing from Phase 16)"
  flows: []
tech_debt:
  - phase: pre-existing
    items:
      - "Companion health/meters saved by get_save_data() but silently dropped by load_save_data() — companions always spawn full HP after load"
  - phase: by-design
    items:
      - "active_buffs not persisted — transient 30s effects, acceptable"
      - "shop_stock not persisted — restocks on zone entry by design"
---

# v1.3.1 Tech Debt & Polish — Milestone Audit Report

**Audited:** 2026-01-29
**Status:** ✅ PASSED (with pre-existing tech debt)
**Overall:** All 5 v1.3 tech debt items resolved. One pre-existing gap discovered in PartyManager.load_save_data() (health/meters not restored).

## Milestone Definition of Done

> Close all tech debt identified in the v1.3 milestone audit. Equipment/inventory persistence (medium) + 4 low-severity quality fixes.

**Verdict:** ✅ Fully achieved. All 5 audit items closed.

## Phase Verification Summary

| Phase | Name | Plans | Verified | Score | Status |
|-------|------|-------|----------|-------|--------|
| 21 | Save System Persistence | 1 | ✅ 21-VERIFICATION.md | 4/4 must-haves | ✅ Passed |
| 22 | v1.3 Polish & Tech Debt | 1 | ✅ 22-VERIFICATION.md | 4/4 must-haves | ✅ Passed |

**Total must-haves verified: 8/8** (across both phases)

## Tech Debt Items Resolved

| # | Item (from v1.3 audit) | Severity | Fix | Phase | Status |
|---|------------------------|----------|-----|-------|--------|
| 1 | Equipment/inventory not saved | Medium | Wired SaveManager to call existing get_save_data/load_save_data helpers, bumped v2→v3 | 21 | ✅ Closed |
| 2 | Mini-boss loot not sellable in shop | Low | Added raccoon_crown (200), crow_feather_coat (250), rat_king_collar (220) to SHOP_EQUIPMENT | 22 | ✅ Closed |
| 3 | load() vs preload() in summon states | Low | Replaced runtime load() with preload() const in alpha_summon.gd and crow_swarm_summon.gd | 22 | ✅ Closed |
| 4 | No poison visual stacking | Low | Added poison_stack_count with escalating green tint (0.15 step, clamped 0.3-0.7) | 22 | ✅ Closed |
| 5 | Phase 17 missing VERIFICATION.md | Low | Created retroactive 17-VERIFICATION.md (7/7 PASS) from existing SUMMARYs | 22 | ✅ Closed |

**Score: 5/5 items resolved**

## Cross-Phase Integration

| # | Integration Point | Score | Detail |
|---|-------------------|-------|--------|
| 1 | Phase 21↔22: Inventory persistence + sellable loot | ✅ 1.0 | Sell removes from inventory → save captures post-sell state correctly |
| 2 | Phase 21↔22: Equipment persistence + mini-boss equipment | ✅ 1.0 | Equip/unequip/sell all reflected in save data correctly |
| 3 | Phase 21→v1.3: Save system completeness | ⚠️ 0.5 | Equipment+inventory+party wired ✅, but companion health/meters saved but NOT restored (pre-existing) |
| 4 | Phase 22→v1.3: Poison stacking across systems | ✅ 1.0 | All 3 poison sources (rat bite, toxic puddle, Rat King cloud) route through apply_poison() correctly |
| 5 | Phase 21→Phase 14: Save version migration | ✅ 1.0 | v2→v3 with .get() defaults, _validate_save_data() unchanged |
| 6 | Phase 22→Phase 18: Shop catalog integration | ✅ 1.0 | Sell-only items (not in DEFAULT_EQUIPMENT_STOCK), shop_ui.gd correctly queries get_sell_price() |
| 7 | Phase 22→Phase 20: Preload consistency | ✅ 0.5 | alpha_summon and crow_swarm_summon now match rat_king.gd pattern |

**Integration Score: 6/7 (86%)**

### Signal/Event Wiring

| Route | Status | Consumers |
|-------|--------|-----------|
| SaveManager.save_game() | ✅ CONSUMED | GameManager (3×), PauseMenu, RingMenu, UiTester |
| SaveManager.load_game() | ✅ CONSUMED | TitleScreen |
| equipment_manager.get_save_data() | ✅ CONSUMED | SaveManager._gather_save_data() |
| inventory.get_save_data() | ✅ CONSUMED | SaveManager._gather_save_data() |
| party_manager.get_save_data() | ✅ CONSUMED | SaveManager._gather_save_data() |
| ShopCatalog.get_sell_price() | ✅ CONSUMED | shop_ui.gd (2 callsites) |
| HealthComponent.apply_poison() | ✅ CONSUMED | 3 independent sources |

**All signal routes verified.**

## E2E Flow Verification

### Flow 1: Loot → Sell → Save → Load ✅ (9/9 steps)
Defeat Alpha Raccoon → receive raccoon_crown → equip → unequip → sell at shop (100 coins) → save → load → crown gone, coins retained

### Flow 2: Full Save Round-Trip ⚠️ (10/12 steps)
All state saved and restored EXCEPT companion health and meters — companions always return to full HP after load. 10 of 12 state fields verified.

### Flow 3: Poison Stacking in Sewers ✅ (7/7 steps)
Rat bite (stack 1, green 0.7) → toxic puddle (stack 2, green 0.55) → Rat King cloud (stack 3, green 0.4) → strongest damage preserved → clear resets to white

**Flow Score: 2.5/3 (83%)**

## Pre-Existing Tech Debt Discovered

### Companion Health/Meters Not Restored (Medium)

**Origin:** Phase 16 (Ring Menu System) — `party_manager.gd`
**Nature:** `get_save_data()` saves `health` and `meters` dicts, but `load_save_data()` ignores them entirely
**Impact:** After every save/load, companions spawn at full HP/meter regardless of state when saved
**Severity:** Medium — functionally "generous" (full health is better than lost health), but violates save contract

**This is NOT a v1.3.1 regression.** Phase 21 correctly wired the SaveManager to call the existing helpers. The bug is that `party_manager.load_save_data()` was already incomplete when written in Phase 16.

### By-Design Non-Persistence (Acceptable)

| Item | Status | Rationale |
|------|--------|-----------|
| active_buffs | Not saved | 30s transient effects — save/load naturally resets them |
| shop_stock | Not saved | Restocks on neighborhood zone entry by design |
| Equipped items not directly sellable | Not a bug | Must unequip first — prevents accidental sell of active gear |

## Codebase Stats (v1.3.1)

| Metric | Value |
|--------|-------|
| Total phases | 22 |
| v1.3.1 phases | 2 (Phases 21-22) |
| v1.3.1 plans executed | 2 |
| v1.3.1 commits | 6 |
| Files modified | 5 source + 1 verification doc |
| Lines added (est.) | ~45 source lines |
| Execution time | ~4 min total |

## Conclusion

v1.3.1 Tech Debt & Polish is **complete**. All 5 tech debt items from the v1.3 audit are resolved. The save system now persists equipment, inventory, and party state. Mini-boss loot is sellable. Summon states are optimized. Poison stacking has visual feedback. Phase 17 has formal verification.

One pre-existing gap was discovered: companion health/meters are saved but not restored by `party_manager.load_save_data()`. This is a Phase 16 issue that was never caught because the save system wasn't wiring to these helpers until Phase 21. It's medium severity and should be addressed in the next milestone.

---

*Audited: 2026-01-29*
*Auditor: Claude (gsd-audit-milestone)*
