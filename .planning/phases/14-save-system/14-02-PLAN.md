---
phase: 14-save-system
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - autoloads/game_manager.gd
  - ui/menus/title_screen.gd
  - ui/menus/title_screen.tscn
  - ui/menus/pause_menu.gd
  - ui/menus/pause_menu.tscn
autonomous: true

must_haves:
  truths:
    - "Auto-save triggers on zone transition"
    - "Auto-save triggers after boss defeat celebration"
    - "Manual save available from pause menu"
    - "Title screen shows Continue if save exists"
    - "New Game prompts for overwrite if save exists"
    - "Load game spawns player at zone entrance"
  artifacts:
    - path: "autoloads/game_manager.gd"
      provides: "Auto-save integration on zone/boss events"
      contains: "SaveManager.save_game()"
    - path: "ui/menus/title_screen.gd"
      provides: "Continue/New Game logic with overwrite confirmation"
    - path: "ui/menus/pause_menu.gd"
      provides: "Save button with feedback"
  key_links:
    - from: "autoloads/game_manager.gd"
      to: "SaveManager.save_game()"
      via: "zone_entered and boss_defeated signals"
      pattern: "SaveManager\\.save_game"
    - from: "ui/menus/title_screen.gd"
      to: "SaveManager"
      via: "has_save() and load_game()"
      pattern: "SaveManager\\.(has_save|load_game)"
---

<objective>
Integrate auto-save triggers, title screen continue/new game, and pause menu save button.

Purpose: Complete save system UX with seamless auto-saves and user-facing save/load options.
Output: Working save flow from title to gameplay with automatic and manual saves.
</objective>

<execution_context>
@~/.config/Claude/get-shit-done/workflows/execute-plan.md
@~/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/14-save-system/14-CONTEXT.md
@.planning/phases/14-save-system/14-01-SUMMARY.md
@autoloads/game_manager.gd
@autoloads/save_manager.gd
@ui/menus/title_screen.gd
@ui/menus/title_screen.tscn
@ui/menus/pause_menu.gd
@ui/menus/pause_menu.tscn
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add auto-save triggers to GameManager</name>
  <files>autoloads/game_manager.gd</files>
  <action>
Add auto-save logic to GameManager. Auto-save triggers:
1. On zone_entered (entering a new zone)
2. After boss_defeated (with delay for celebration)

In `_ready()`, after existing connects:
```gdscript
    # Auto-save on zone entry
    Events.zone_entered.connect(_on_zone_entered_autosave)
    # Auto-save after boss defeat (delayed for celebration)
    Events.boss_defeated.connect(_on_boss_defeated_autosave)
```

Add new methods:
```gdscript
# =============================================================================
# AUTO-SAVE
# =============================================================================

## Auto-save on zone entry
func _on_zone_entered_autosave(zone_name: String) -> void:
    # Skip if this is initial game load (no player yet)
    await get_tree().process_frame
    var player = get_tree().get_first_node_in_group("player")
    if player and player.progression and player.progression.current_level > 0:
        SaveManager.save_game()
        print("[GameManager] Auto-saved on zone entry: ", zone_name)

## Auto-save after boss defeat (delayed for celebration/rewards)
func _on_boss_defeated_autosave(_boss: Node) -> void:
    # Wait 3 seconds for victory celebration and rewards
    await get_tree().create_timer(3.0).timeout
    SaveManager.save_game()
    print("[GameManager] Auto-saved after boss defeat")
```
  </action>
  <verify>Read game_manager.gd and confirm auto-save methods exist</verify>
  <done>Auto-save triggers on zone entry and 3s after boss defeat</done>
</task>

<task type="auto">
  <name>Task 2: Update title screen with Continue/New Game logic</name>
  <files>ui/menus/title_screen.gd, ui/menus/title_screen.tscn</files>
  <action>
Modify `title_screen.tscn` to add:
1. "Continue" button (before Start, visible only if save exists)
2. Confirmation dialog (for New Game overwrite)

In scene tree, add to VBoxContainer:
- ContinueButton (Button) - above StartButton, text "Continue"
- ConfirmationDialog (AcceptDialog/ConfirmationDialog) - for overwrite prompt

Update `title_screen.gd`:
```gdscript
extends Control
class_name TitleScreen
## Main title screen with continue and new game options.

@onready var continue_button: Button = $VBoxContainer/ContinueButton
@onready var start_button: Button = $VBoxContainer/StartButton
@onready var quit_button: Button = $VBoxContainer/QuitButton
@onready var confirm_dialog: ConfirmationDialog = $ConfirmationDialog

func _ready() -> void:
    continue_button.pressed.connect(_on_continue_pressed)
    start_button.pressed.connect(_on_start_pressed)
    quit_button.pressed.connect(_on_quit_pressed)
    confirm_dialog.confirmed.connect(_on_new_game_confirmed)
    
    # Update button visibility based on save state
    _update_buttons()
    
    # Connect focus signals for navigation sounds
    continue_button.focus_entered.connect(_on_button_focused)
    start_button.focus_entered.connect(_on_button_focused)
    quit_button.focus_entered.connect(_on_button_focused)
    
    # Play title music
    AudioManager.play_music("title", false)

func _update_buttons() -> void:
    if SaveManager.has_save():
        continue_button.visible = true
        start_button.text = "New Game"
        continue_button.grab_focus()
    else:
        continue_button.visible = false
        start_button.text = "Start Game"
        start_button.grab_focus()

func _on_button_focused() -> void:
    AudioManager.play_sfx("menu_navigate")

func _on_continue_pressed() -> void:
    AudioManager.play_sfx("menu_select")
    # Load saved game
    if not SaveManager.load_game():
        # If load fails, show error and stay on title
        push_error("Failed to load save game")
        _update_buttons()

func _on_start_pressed() -> void:
    AudioManager.play_sfx("menu_select")
    if SaveManager.has_save():
        # Show confirmation dialog
        confirm_dialog.dialog_text = "This will overwrite your saved progress.\nContinue?"
        confirm_dialog.popup_centered()
    else:
        _start_new_game()

func _on_new_game_confirmed() -> void:
    SaveManager.delete_save()
    _start_new_game()

func _start_new_game() -> void:
    # Reset game state
    GameManager.coins = 0
    GameManager.boss_defeated = false
    get_tree().change_scene_to_file("res://world/zones/neighborhood.tscn")

func _on_quit_pressed() -> void:
    AudioManager.play_sfx("menu_select")
    get_tree().quit()
```

For the .tscn file, add:
1. ContinueButton as first child of VBoxContainer
2. ConfirmationDialog as child of TitleScreen root
  </action>
  <verify>
1. Read title_screen.gd and confirm continue/new game logic
2. Read title_screen.tscn and confirm ContinueButton and ConfirmationDialog exist
  </verify>
  <done>Title screen has Continue (if save), New Game with overwrite confirm</done>
</task>

<task type="auto">
  <name>Task 3: Add Save button to pause menu</name>
  <files>ui/menus/pause_menu.gd, ui/menus/pause_menu.tscn</files>
  <action>
Add Save button to pause menu between Resume and Quit.

In `pause_menu.tscn`, add SaveButton to VBoxContainer after ResumeButton:
- SaveButton (Button) - text "Save Game"

Update `pause_menu.gd`:

Add onready var:
```gdscript
@onready var save_button: Button = $Panel/VBoxContainer/SaveButton
```

In `_ready()`, add:
```gdscript
    save_button.pressed.connect(_on_save_pressed)
```

Add save handler:
```gdscript
func _on_save_pressed() -> void:
    AudioManager.play_sfx("menu_select")
    if SaveManager.save_game():
        # Visual feedback - flash button green briefly
        var original_text = save_button.text
        save_button.text = "Saved!"
        save_button.disabled = true
        await get_tree().create_timer(1.0).timeout
        save_button.text = original_text
        save_button.disabled = false
    else:
        save_button.text = "Save Failed"
        await get_tree().create_timer(1.0).timeout
        save_button.text = "Save Game"
```
  </action>
  <verify>
1. Read pause_menu.gd and confirm save button logic
2. Read pause_menu.tscn and confirm SaveButton exists in VBoxContainer
  </verify>
  <done>Pause menu has Save button with visual feedback</done>
</task>

</tasks>

<verification>
1. Auto-save triggers on zone transition (check console output)
2. Auto-save triggers 3s after boss defeat
3. Title screen shows Continue button when save exists
4. Continue button loads saved game state
5. New Game prompts for confirmation when save exists
6. Pause menu Save button saves and shows "Saved!" feedback
7. Loaded game has correct level, coins, zone
</verification>

<success_criteria>
- Zone transition triggers auto-save
- Boss defeat triggers auto-save after 3s delay
- Title screen dynamically shows Continue/New Game based on save
- New Game asks for confirmation before overwriting save
- Continue loads saved state (zone, level, coins, boss flag)
- Pause menu Save button works with feedback
</success_criteria>

<output>
After completion, create `.planning/phases/14-save-system/14-02-SUMMARY.md`
</output>
