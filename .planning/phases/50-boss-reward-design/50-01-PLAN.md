---
phase: 50-boss-reward-design
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Defeating Alpha Raccoon unlocks meaningful reward"
    - "Defeating Crow Matriarch unlocks meaningful reward"
    - "Defeating Rat King unlocks meaningful reward"
    - "Defeating Pigeon King unlocks meaningful reward"
    - "Boss defeat screen shows all four rewards clearly"
    - "Boss tracker available from pause menu"
  artifacts:
    - path: "docs/boss_rewards.md"
      provides: "Boss reward design document"
    - path: "characters/enemies/enemy_base.gd"
      provides: "Drop reward distribution hooks"
      contains: "on_enemy_defeated, _give_reward"
    - path: "world/zones/boss_arena.gd"
      provides: "Boss arena defeat handling"
      contains: "on_boss_defeated, _show_reward_screen"
    - path: "ui/hud/boss_tracker.tscn"
      provides: "Visual boss progress display"
      exports: ["show_defeated", "update_unlock", "is_unlocked"]
    - path: "ui/pause/pause_menu.tscn"
      provides: "Pause menu access point"
      exports: ["get_boss_tracker", "open_boss_tracker"]
    - path: "autoloads/game_manager.gd"
      provides: "Boss defeat flags and reward storage"
      contains: "save_game, load_game"
    - path: "systems/party/party_manager.gd"
      provides: "Companion upgrade system for boss rewards"
      contains: "unlock_companion_tier, upgrade_companion"
    - path: "autoloads/save_manager.gd"
      provides: "Save boss defeat state"
      contains: "save_game, load_game"
  key_links:
    - from: "enemy_base.gd"
      to: "game_manager"
      via: "game_manager.pending_boss_reward triggers drop calculation"
      pattern: "on_enemy_defeated.*pending_boss_reward"
    - from: "enemy_base.gd"
      to: "game_manager"
      via: "game_manager.mini_bosses_defeated[boss_id] = true"
      pattern: "mini_bosses_defeated[\\\" + boss_id + "\"]"
    - from: "boss_tracker.tscn"
      to: "pause_menu"
      via: "pause_menu.get_boss_tracker().update_unlock(boss_id)"
      pattern: "get_boss_tracker.*update_unlock"
    - from: "game_manager"
      to: "save_manager"
      via: "save_manager.save_game() after boss defeat"
      pattern: "game_manager.mini_bosses_defeated.*save_game\("
    - from: "game_manager"
      to: "party_manager"
      via: "game_manager.pending_boss_reward = boss_id"
      pattern: "pending_boss_reward.*=.*\\\"" + boss_id

---

<objective>
Design boss reward system that makes mini-boss defeats feel meaningful and unlock tangible progress.

Purpose: Each mini-boss (Alpha Raccoon, Crow Matriarch, Rat King, Pigeon King) should unlock unique rewards that advance gameplay. Players should feel rewarded for effort with new zones, equipment tiers, or companion abilities — not just experience.

Output:
- Boss reward design document defining what each boss unlocks
- Updated GameManager with boss reward tracking fields
- Boss tracker UI component showing progress and unlockable rewards
- Enemy integration hook to trigger reward drops on boss defeat
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/PROJECT.md

# Only reference prior plans if genuinely needed for context
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create boss reward design document</name>
  <files>docs/boss_rewards.md</files>
  <action>Create documentation defining reward system architecture. Document:  
  1. Four mini-bosses with unique identity and defeat patterns
  2. Reward types per boss (Zone unlock, Equipment tier, Companion ability, Secret area access)
  3. Technical implementation approach using existing signals (Events.enemy_defeated)
  4. Integration points with GameManager, SaveManager, EnemyBase, PartyManager
  
  Include design rationale, visual presentation approach, and save data structure for boss rewards.
  DO NOT implement any code — this is design/planning only.</action>
  <verify>File exists at docs/boss_rewards.md with complete reward architecture defined</verify>
  <done>Boss reward design document created with all four boss rewards defined and technical integration points identified</done>
</task>

<task type="auto">
  <name>Task 2: Add boss reward tracking to GameManager</name>
  <files>autoloads/game_manager.gd</files>
  <action>Add boss reward tracking fields to GameManager state:
  1. Add `pending_boss_reward: String = ""` - Tracks which boss reward is pending collection
  2. Add boss-specific reward flags (e.g., `alpha_raccoon_reward_collected: bool = false`)
  3. Add reward redemption methods: `_grant_boss_reward(boss_id: String)` and `_is_reward_ready(boss_id: String) -> bool`
  4. Hook into Events.boss_defeated to auto-track boss defeats
  
  Ensure all boss reward state is properly saved via existing SaveManager integration (v3 save data already supports boss flags).
  
  Follow existing code style (snake_case variables, proper comments, DebugLogger for errors).</action>
  <verify>GameManager has pending_boss_reward, _grant_boss_reward, and _is_reward_ready methods with proper implementation</verify>
  <done>Boss reward tracking infrastructure in GameManager — boss defeats automatically track rewards without manual triggers</done>
</task>

<task type="auto">
  <name>Task 3: Create boss tracker UI component</name>
  <files>ui/hud/boss_tracker.tscn (new), ui/hud/boss_tracker.gd</files>
  <action>Create boss tracker HUD component showing defeated bosses and unlockable rewards:
  Scene file (boss_tracker.tscn):
  - Root Control node with vertical layout
  - Four boss cards (Alpha Raccoon, Crow Matriarch, Rat King, Pigeon King)
  - Each card shows: boss name, defeat status (✓/✗/?), reward preview
  - Lock/unlock indicators for each reward tier
  
  Script (boss_tracker.gd):
  - Load boss data from GameManager.mini_bosses_defeated
  - Update UI on boss defeat via Events.boss_defeated signal
  - Implement `show_defeated(boss_id)`, `update_unlock(boss_id)`, `is_unlocked(boss_id)` methods
  - Connect to PauseMenu for boss tracker access
  
  Follow existing HUD patterns (HealthBar, BuffIcons style — Control-based, clean code structure).
  Use project-provided UI assets and font sizing.</action>
  <verify>Boss tracker scene loads without errors, shows all four bosses, updates on defeat, can be opened from pause menu</verify>
  <done>Boss tracker HUD component created — displays boss progress and reward availability</done>
</task>

<task type="auto">
  <name>Task 4: Integrate boss rewards with EnemyBase</name>
  <files>characters/enemies/enemy_base.gd</files>
  <action>Add boss reward hook to EnemyBase to trigger reward drops on boss defeat:
  Modify `_on_death()` to check if enemy has a boss_id set (mini-bosses only)
  2. If boss_id is set, emit `Events.boss_defeated.emit(enemy_id)` before queue_free
  3. Add optional `boss_reward: Dictionary` export property for boss-specific rewards (default empty)
  4. Ensure regular enemies don't emit boss_defeated signal (boss_id = "" check)
  
  This ensures boss-specific enemies (Alpha Raccoon, etc.) trigger boss reward tracking in GameManager automatically.</action>
  <verify>EnemyBase has boss_id export property, emits boss_defeated for mini-bosses, regular enemies unaffected</verify>
  <done>Boss reward hooks integrated — defeating mini-bosses now triggers reward system automatically</done>
</task>

</tasks>

<verification>
Overall phase verification:
- [ ] Boss reward design document exists with complete architecture defined
- [ ] GameManager tracks boss defeats with pending rewards
- [ ] Boss tracker UI shows all four bosses with unlock status
- [ ] EnemyBase integration triggers boss_defeated events for mini-bosses
- [ ] Boss tracker accessible from pause menu
- [ ] Boss reward state properly saved via existing SaveManager

Test procedure:
1. Load game and defeat Alpha Raccoon
2. Open pause menu → Boss Tracker → Verify Alpha Raccoon shows ✓
3. Save and re
