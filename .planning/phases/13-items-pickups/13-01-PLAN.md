---
phase: 13-items-pickups
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/health/health_pickup.gd
  - autoloads/events.gd
autonomous: true

must_haves:
  truths:
    - "Pickups have magnet effect when player is close"
    - "Pickup collected emits global signal"
  artifacts:
    - path: "components/health/health_pickup.gd"
      provides: "Health pickup with magnet"
      contains: "magnet_range"
  key_links:
    - from: "health_pickup.gd"
      to: "events.gd"
      via: "pickup_collected signal"
      pattern: "pickup_collected\\.emit"
---

<objective>
Enhance existing health pickup with magnet effect and add pickup signals.

Purpose: Make pickup collection feel more responsive with magnet pull
Output: Enhanced health pickup with magnet behavior
</objective>

<execution_context>
@~/.config/Claude/get-shit-done/workflows/execute-plan.md
@~/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@components/health/health_pickup.gd
@autoloads/events.gd
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add magnet effect to HealthPickup</name>
  <files>
    components/health/health_pickup.gd
  </files>
  <action>
Enhance existing health_pickup.gd to add magnet behavior:

Add properties:
```gdscript
@export var magnet_range: float = 40.0  # Start moving toward player
@export var magnet_speed: float = 150.0  # Speed when magneting
```

Add magnet logic to _process():
```gdscript
func _process(delta: float) -> void:
    # Existing bob animation code...
    
    # Add magnet effect - pull toward player when close
    var player = _get_player()
    if player:
        var distance = global_position.distance_to(player.global_position)
        if distance <= magnet_range:
            var direction = (player.global_position - global_position).normalized()
            global_position += direction * magnet_speed * delta
            # Update bob center so it doesn't fight the magnet
            start_y = global_position.y - sin(bob_time) * 2.0

func _get_player() -> Node:
    var players = get_tree().get_nodes_in_group("player")
    return players[0] if players.size() > 0 else null
```

Keep existing behavior:
- Bob animation (sin wave)
- 15 second lifetime
- 20 HP heal
- Audio playback
  </action>
  <verify>
Walk near a health pickup - it should start moving toward player
Collect pickup - heals as before
  </verify>
  <done>Health pickups have magnet pull effect when player is within 40px</done>
</task>

<task type="auto">
  <name>Task 2: Add pickup_collected signal to Events</name>
  <files>
    autoloads/events.gd
    components/health/health_pickup.gd
  </files>
  <action>
Add to events.gd in PICKUP section (or create section):
```gdscript
# =============================================================================
# PICKUP SIGNALS
# =============================================================================

## Emitted when any pickup is collected
signal pickup_collected(pickup_type: String, value: int)
```

Update health_pickup.gd _on_body_entered to emit signal:
```gdscript
func _on_body_entered(body: Node2D) -> void:
    if body.is_in_group("player"):
        # Heal the player
        if body.has_node("HealthComponent"):
            var health = body.get_node("HealthComponent")
            health.heal(heal_amount)
        
        # Emit pickup signal
        Events.pickup_collected.emit("health", heal_amount)
        
        # Play pickup sound
        AudioManager.play_sfx("health_pickup")
        
        # Existing pickup effect code...
```
  </action>
  <verify>
Collect health pickup
Check Events.pickup_collected was emitted (via debugger or print)
  </verify>
  <done>pickup_collected signal exists and is emitted on health pickup collection</done>
</task>

</tasks>

<verification>
1. Run game
2. Find or spawn a health pickup
3. Walk within 40px of pickup - should start moving toward player
4. Collect pickup - heals 20 HP, plays sound
5. Check console/debugger for pickup_collected signal
</verification>

<success_criteria>
- Health pickups have magnet effect within 40px
- pickup_collected signal emitted on collection
- Existing functionality preserved (bob, despawn, heal, audio)
</success_criteria>

<output>
After completion, create `.planning/phases/13-items-pickups/13-01-SUMMARY.md`
</output>
