---
phase: 35-world-items-effects
plan: 02
type: execute
wave: 4
depends_on: ["34-01", "35-01"]
files_modified:
  - components/effects/hit_spark.tscn
  - components/effects/dust_puff.tscn
  - components/effects/death_poof.tscn
  - components/health/health_pickup.tscn
  - components/health/health_pickup.gd
  - components/pickup/coin_pickup.tscn
  - components/pickup/coin_pickup.gd
  - autoloads/effects_manager.gd
autonomous: true

must_haves:
  truths:
    - "Hit spark, death poof, and dust puff effects use sprite textures"
    - "Health heart pickup displays as animated sprite instead of green cross polygon"
    - "Coin pickup displays as animated sprite instead of gold octagon polygon"
    - "Full game walkthrough shows zero Polygon2D placeholder shapes on characters/enemies"
    - "EffectsManager scene-based particle effects use textures"
  artifacts:
    - path: "components/effects/hit_spark.tscn"
      provides: "Sprite-textured particle effect"
      contains: "texture"
    - path: "components/health/health_pickup.tscn"
      provides: "Heart pickup with sprite visual"
      contains: "Sprite2D"
    - path: "components/pickup/coin_pickup.tscn"
      provides: "Coin pickup with sprite visual"
      contains: "Sprite2D"
  key_links:
    - from: "autoloads/effects_manager.gd"
      to: "components/effects/*.tscn"
      via: "preloaded effect scenes with textures"
    - from: "components/health/health_pickup.gd"
      to: "art/generated/items/health_pickup.png"
      via: "Sprite2D texture"
---

<objective>
Replace scene-based particle effects with sprite textures, replace pickup Polygon2D shapes with sprites, and perform integration verification that zero placeholder shapes remain in the game.

Purpose: This is the final visual polish phase — every remaining colored shape gets replaced with pixel art, completing the v1.6 milestone.
Output: All visual elements are sprite-based. Zero Polygon2D characters or ColorRect particles remain in main gameplay.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/32-player-sprites/32-01-SUMMARY.md
@.planning/phases/34-enemy-boss-sprites/34-01-SUMMARY.md
@components/effects/hit_spark.tscn
@components/health/health_pickup.gd
@components/pickup/coin_pickup.gd
@autoloads/effects_manager.gd
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add textures to particle effects and replace pickup Polygon2Ds</name>
  <files>
    components/effects/hit_spark.tscn
    components/effects/dust_puff.tscn
    components/effects/death_poof.tscn
    components/health/health_pickup.tscn
    components/health/health_pickup.gd
    components/pickup/coin_pickup.tscn
    components/pickup/coin_pickup.gd
  </files>
  <action>
  **Part A: Particle effect textures**

  The 3 scene-based effects use CPUParticles2D with default square particles. Add sprite textures:

  NOTE: The `art/generated/effects/` directory may be empty. If effect sprites don't exist yet, create simple placeholder textures programmatically:
  - hit_spark: 8x8 white star/diamond shape
  - dust_puff: 4x4 brownish circle
  - death_poof: 8x8 white cloud puff

  OR check if the art generation pipeline can produce them. If `art/generated/effects/` has files, use those.

  **If effect sprites exist:**
  1. In `hit_spark.tscn`: Set `CPUParticles2D.texture = load("res://art/generated/effects/hit_spark.png")`
  2. In `dust_puff.tscn`: Set `CPUParticles2D.texture = load("res://art/generated/effects/dust_puff.png")`
  3. In `death_poof.tscn`: Set `CPUParticles2D.texture = load("res://art/generated/effects/death_poof.png")`
     - Also update the ColorRect flash to be a Sprite2D with a white circle texture or keep as ColorRect (it's a screen flash, acceptable)

  **If effect sprites DON'T exist (effects/ is empty):**
  Create minimal textures in code within the .tscn resource or use Godot's built-in gradient textures:
  1. For CPUParticles2D, set `texture` to a small `GradientTexture2D` with radial gradient (soft circle instead of hard square)
  2. This is still a major improvement over default square particles
  3. Add a note to the summary that hand-drawn effect sprites would further improve quality

  **Part B: Health pickup sprite replacement**

  In `health_pickup.tscn`:
  1. Remove the `Polygon2D` node (the green cross shape)
  2. Add `Sprite2D` named `Sprite2D`
  3. Set texture: `load("res://art/generated/items/health_pickup.png")`
  4. Set `centered = true`

  In `health_pickup.gd`:
  1. Change `@onready var sprite: Polygon2D = $Sprite2D` to `@onready var sprite: Sprite2D = $Sprite2D`
  2. Replace glow pulse code:
     - Old: `sprite.modulate = Color(pulse, 1.0, pulse, 1.0)` — keep this, modulate works on Sprite2D
  3. Remove any `sprite.color` references, use `sprite.modulate` instead
  4. Keep bob animation (`position.y = ...`), magnet behavior, collection effects — all still work

  **Part C: Coin pickup sprite replacement**

  In `coin_pickup.tscn`:
  1. Remove the `Polygon2D` node (the gold octagon)
  2. Add `Sprite2D` named `Sprite2D`
  3. Set texture: `load("res://art/generated/items/coin_pickup.png")`
  4. Set `centered = true`

  In `coin_pickup.gd`:
  1. Change sprite type to `Sprite2D`
  2. Replace gold shimmer code:
     - Old: `sprite.modulate = Color(1.0, shimmer, 0.2, 1.0)` — keep, works on Sprite2D
  3. Remove any `sprite.color` references
  4. Keep bob animation and magnet behavior
  </action>
  <verify>
  - Hit an enemy — hit spark effect shows texture (not default squares)
  - Kill an enemy — death poof effect shows texture
  - Dodge/move — dust puff shows texture
  - Health pickup in world — shows pixel art heart, bobs, has magnet
  - Coin pickup in world — shows pixel art coin, bobs, has magnet
  - Collect pickups — burst effect plays
  - Grep pickup .gd files for `Polygon2D` — zero matches
  </verify>
  <done>All 3 particle effects use textures, health/coin pickups display as sprites, all pickup behavior preserved</done>
</task>

<task type="auto">
  <name>Task 2: Integration sweep — verify zero placeholder shapes remain</name>
  <files>
    autoloads/effects_manager.gd
  </files>
  <action>
  This is the INTG-01 and INTG-02 verification sweep.

  **INTG-01: Zero Polygon2D character nodes**

  Run a comprehensive grep across the entire codebase:
  ```bash
  grep -rn "Polygon2D" characters/ components/health/ components/pickup/ --include="*.tscn" --include="*.gd"
  ```

  Expected: Zero matches for Polygon2D used as character/enemy/NPC visuals.

  Acceptable exceptions:
  - Polygon2D in non-visual contexts (collision visualization, debug tools)
  - Polygon2D in ambient_particles.gd (minor cosmetic, not characters)
  - References in comments

  If any Polygon2D character visuals remain, fix them following the same pattern.

  **INTG-02: EffectsManager sprite textures**

  In `effects_manager.gd`, the inline effects (level-up, victory, attack swoosh, etc.) use `ColorRect.new()`. A full replacement of ALL inline effects is out of scope for this milestone.

  **What IS in scope (fix these):**
  1. `_create_death_explosion()` — enemy death particles (10 ColorRect, 2-5px). Replace with Sprite2D using the death_poof texture at small scale, or keep as ColorRect (these are 0.5s ephemeral particles, barely visible).
  2. `spawn_pickup_effect()` — pickup burst (5-8 ColorRect, 2x2). Replace with the pickup's sprite texture at small scale.
  3. `flash_pickup()` — pickup flash (12x12 ColorRect). Replace with Sprite2D using the pickup texture.

  **What is OUT of scope (leave as ColorRect):**
  - Level-up effects (aura, rings, sparkles, text) — cosmetic UI overlay
  - Victory effects (text, fireworks) — cosmetic UI overlay
  - Attack swoosh — very brief visual
  - Dodge afterimages — already fixed in Phase 32
  - Screen flash — fullscreen overlay, not a character
  - Damage direction indicator — screen edge overlay
  - Ambient particles (dust motes, leaves, etc.) — environmental, not characters

  Document the out-of-scope items as future polish candidates.

  **Final walkthrough verification:**
  1. Start new game from title screen
  2. Walk through Neighborhood — Momi is sprite, companions are sprites, Nutkin is sprite
  3. Fight raccoons — enemies are sprites, hit sparks are textured
  4. Open ring menu — icons are pixel art
  5. Visit shop — icons are pixel art
  6. Enter Backyard — crows are sprites
  7. Enter Sewers — rats, shadow creatures are sprites
  8. Fight mini-bosses — all sprites
  9. Fight Raccoon King — sprite with enrage variant
  10. No colored squares visible as characters at any point
  </action>
  <verify>
  - `grep -rn "Polygon2D" characters/ --include="*.tscn"` returns zero matches
  - `grep -rn "Polygon2D" characters/ --include="*.gd"` returns zero matches (or only comments)
  - `grep -rn "Polygon2D" components/health/ components/pickup/ --include="*.tscn"` returns zero matches
  - Full game traversal shows no colored squares as characters or pickups
  </verify>
  <done>Integration verified: zero Polygon2D character shapes, scene-based effects use textures, pickup effects use sprite textures, all character entities display as pixel art</done>
</task>

</tasks>

<verification>
1. FX-01: Hit spark, death poof, dust puff all use sprite textures (not default squares)
2. FX-02: Health heart and coin pickups are sprites with bob/magnet/collection effects
3. INTG-01: grep confirms zero Polygon2D in character/enemy/NPC .tscn files
4. INTG-02: EffectsManager scene-based effects use textures
5. Full game walkthrough from title to boss defeat shows zero colored-square characters
</verification>

<success_criteria>
- All 6 requirements (FX-01, FX-02, INTG-01, INTG-02, plus effective WRLD-01/WRLD-02 from plan 01) verified
- Zero Polygon2D character nodes across entire game
- Particle effects visually improved with textures
- Pickup items display as pixel art
- v1.6 Visual Polish milestone achievable after this plan completes
</success_criteria>

<output>
After completion, create `.planning/phases/35-world-items-effects/35-02-SUMMARY.md`
</output>
